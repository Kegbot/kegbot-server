{% extends "kegadmin/base.html" %}
{% load kegweblib %}
{% load crispy_forms_tags %}

{% block title %}Kegbot Admin: Edit Tap: {{ tap.name }} | {{ block.super }}{% endblock %}
{% block pagetitle %}Kegbot Admin: Edit Tap: {{ tap.name }}{% endblock %}

{% block kegadmin-main %}
{% if current_keg %}
<h2>Current Keg</h2>
<table class="table table-striped table-hover">
<tr>
  <th>Keg</th>
  <td><a href="{% url 'kegadmin-edit-keg' current_keg.id %}">{{ current_keg }}</a></td>
</tr>
<tr>
  <th>Tapped</th>
  <td>{{ current_keg.start_time }}</td>
</tr>
<tr>
  <th>Volume</th>
  <td>{% volume current_keg.remaining_volume_ml %} remaining ({{ current_keg.percent_full|floatformat:2 }}% full)</td>
</tr>
</table>
{% crispy end_keg_form %}

<h2>Add Drink</h2>
<p>
  Manually record a drink using the form below.
  You may leave the <em>username</em> field blank to
  add an anonymous pour.
</p>

<form action="" class="user-select" method="POST">{% csrf_token %}
<div class="input-prepend input-append">
{% if kbsite.settings.volume_display_units == 'metric' %}
  <input type="hidden" name="units" value="mL">
  <input class="span4" type="text" name="volume" placeholder="123">
  <span class="add-on">mL</span>
{% else %}
  <input type="hidden" name="units" value="oz">
  <input class="span4" type="text" name="volume" placeholder="1.23">
  <span class="add-on">oz</span>
{% endif %}
  <input class="span4" type="text" name="username" placeholder="username">
<button class="btn btn-info" name="submit_record_drink" type="submit">
  <i class="icon-plus-sign icon-white"></i> Record
</button>
</div>
</form>

<h2>Add Spill</h2>
<p>
  Manually record a spill using the form below. Spills are
  <em>not</em> attributed to any user and are <em>not</em> saved as an event.
  You may also update the keg's total spilled volume on the
  <a href="{% url 'kegadmin-edit-keg' current_keg.id %}">keg admin page</a>.
</p>

<form action="" class="user-select" method="POST">{% csrf_token %}
<div class="input-prepend input-append">
{% if kbsite.settings.volume_display_units == 'metric' %}
  <input type="hidden" name="units" value="mL">
  <input class="span4" type="text" name="volume" placeholder="123">
  <span class="add-on">mL</span>
{% else %}
  <input type="hidden" name="units" value="oz">
  <input class="span4" type="text" name="volume" placeholder="1.23">
  <span class="add-on">oz</span>
{% endif %}
<button class="btn btn-info" name="submit_record_spill" type="submit">
  <i class="icon-plus-sign icon-white"></i> Record
</button>
</div>
</form>

{% else %}
  <h2>Empty Tap, Activate Keg</h2>
  {% if available_kegs %}
    <button id="show_create" class="btn btn-info">Create New Keg</button>
    <button id="show_list" class="btn btn-info">Choose Untapped Keg</button>

    <div id="create_new_keg" style="display:none;">
      <BR>
      {% crispy activate_keg_form %}
    </div>
    <div id="list_untapped_kegs" style="display:none;margin-left:50px">
      <BR>
      <form action="" class="user-select" method="POST">{% csrf_token %}
        <input type="hidden" name="tap_id" value="{{tap.id}}">
        <select name="keg_id" style="width:400px;">
          {% for keg in available_kegs %}
            <option value="{{keg.id}}">{{keg}}</option>
          {% endfor %}
        </select>
        <button class="btn btn-primary" style="margin-top:-10px;" name="submit_keg_choice" type="submit">
          Activate Keg
        </button>
      </form>
    </div>
  {% else %}
    {% crispy activate_keg_form %}
  {% endif %}

{% endif %}


<h2>Tap Settings</h2>
{% crispy tap_settings_form %}

<h2>Delete Tap</h2>
{% crispy delete_tap_form %}


{% endblock %}

{% block kb-extrajs %}
<script type="text/javascript">
$(document).ready(function () {
  $('#div_id_full_volume_ml').hide();
    $('#id_keg_size').change(function () {
      var choice = $(this).val();
      if (choice == 'other') {
          $('#div_id_full_volume_ml').show();
        } else {
          $('#div_id_full_volume_ml').hide();
        }
    })
  $("#show_create").click(function() {
    $("#create_new_keg").show();
    $("#list_untapped_kegs").hide();
  });
  $("#show_list").click(function() {
    $("#create_new_keg").hide();
    $("#list_untapped_kegs").show();
  });
});
</script>
{% endblock %}
